####################################
# Bin Collection
####################################
- unique_id: bin_collection
  name: Bin Collection
  icon: mdi:trash-can
  state: >
    {% set map = {"RECYCLE": "blue", "DOMESTIC": "black", "ORGANIC": "green"} %}
    {{ "The " }}
    {%- for type in state_attr('sensor.bin_collection_data', 'roundTypes') -%}
      {%- if loop.length > 1 -%}
        {%- if loop.first -%}
          {{map[type]}}
        {%- elif loop.last -%}
          {{ ", and " }}{{map[type]}}
        {%- else -%}
          {{ ", " }}{{map[type]}}
        {%- endif -%}
      {%- else -%}
        {{map[type]}}
      {%- endif -%}
    {%- endfor -%}
      {{strptime(state_attr('sensor.bin_collection_data', 'date'),"%Y-%m-%dT%H:%M:%SZ").strftime(" bin will be collected on %A, %b %d")}}
  attributes:
    Date: "{{ strptime(state_attr('sensor.bin_collection_data', 'date'),'%Y-%m-%dT%H:%M:%SZ').strftime('%d/%m/%Y') }}"
    Day: "{{ strptime(state_attr('sensor.bin_collection_data', 'date'),'%Y-%m-%dT%H:%M:%SZ').strftime('%A') }}"
    Types: >
      {% set map = {"RECYCLE": "blue", "DOMESTIC": "black", "ORGANIC": "green"} %}
      {%- for type in state_attr('sensor.bin_collection_data', 'roundTypes') -%}
        {%- if loop.length > 1 -%}
          {%- if loop.first -%}
            {{map[type]}}
          {%- elif loop.last -%}
            {{ ", and " }}{{map[type]}}
          {%- else -%}
            {{ ", " }}{{map[type]}}
          {%- endif -%}
        {%- else -%}
          {{map[type]}}
        {%- endif -%}
      {%- endfor -%}
    Delayed: "{% if state_attr('sensor.bin_collection_data', 'slippedCollection') %}Yes{% else %}No{% endif %}"
    Black: "{% if 'DOMESTIC' in state_attr('sensor.bin_collection_data', 'roundTypes') %}Yes{% else %}No{% endif %}"
    Blue: "{% if 'RECYCLE' in state_attr('sensor.bin_collection_data', 'roundTypes') %}Yes{% else %}No{% endif %}"
    Green: "{% if 'ORGANIC' in state_attr('sensor.bin_collection_data', 'roundTypes') %}Yes{% else %}No{% endif %}"
    Timestamp: "{{ as_timestamp(strptime(state_attr('sensor.bin_collection_data', 'date'),'%Y-%m-%dT%H:%M:%SZ')) }}"
    Reminder: >
      {% set map = {"RECYCLE": "blue", "DOMESTIC": "black", "ORGANIC": "green"} %}
      {{ "The " }}
        {%- for type in state_attr('sensor.bin_collection_data', 'roundTypes') -%}
          {%- if loop.length > 1 -%}
            {%- if loop.first -%}
              {{map[type]}}
            {%- elif loop.last -%}
              {{ " and " }}{{map[type]}}
            {%- else -%}
              {{ ", " }}{{map[type]}}
            {%- endif -%}
          {%- else -%}
            {{map[type]}}
          {%- endif -%}
        {%- endfor -%}
        {{" bin will be collected tomorrow, make sure they are out!"}}